<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<title>Uebung 13</title>
 <style type="text/css">
	 canvas {}
</style>
    <script type="text/javascript" src="https://threejs.org/build/three.js"></script>


<script type="text/javascript">


var scene, camera, renderer, p1, p2, pointGeometry;

function setPixel(x, y, fall) {
    if (fall == 1)
        var pixel = [x, y];
    else if (fall == 2)
        var pixel = [y, x];
    else if (fall == 3)
        var pixel = [x, -y];
    else
        var pixel = [y, -x];
    var p = new THREE.Vector3();
    p.x = pixel[0];
    p.y = pixel[1];
    p.z = 0;
    pointGeometry.vertices.push(p);
}

function bresenham(x0, y0, x1, y1, fall) {
    var dx = x1 - x0;
    var dy = y1 - y0;
    var d = 2 * dy - dx;
    var incrE = 2 * dy;
    var incrNE = 2 * (dy - dx);
    var x = x0;
    var y = y0;
    setPixel(x0, y0, fall);
    while (x < x1) {
        if (d <= 0) {
            d += incrE;
            x++;
        } else {
            d += incrNE;
            x++; y++;
        }
        setPixel(x, y, fall);
    }
}

function line(p1, p2) {
   if (p1.x > p2.x) {
        var temp = p2;
        p2 = p1;
        p1 = temp;
    }
    var dx = p2.x - p1.x;
    var dy = p2.y - p1.y;
    if (Math.abs(dx) < Math.abs(dy) && dy > 0) {
        //Fall 2: 45 - 90 Grad
        bresenham(p1.y, p1.x, p2.y, p2.x, 2);
    }
    else if (Math.abs(dx) > Math.abs(dy) && dy < 0) {
        //Fall 3: 315 - 360 Grad
        bresenham(p1.x, -p1.y, p2.x, -p2.y, 3);
    }
    else if (Math.abs(dx) < Math.abs(dy) && dy < 0) {
        //Fall 4: 270 - 315 Grad
        bresenham(-p1.y, p1.x, -p2.y, p2.x, 4);
    }
    else
        bresenham(p1.x, p1.y, p2.x, p2.y, 1);
}


// Zeichnen der Szene
function definitionScene() {
    scene = new THREE.Scene();
    // Definition der Kamera
    camera = new THREE.OrthographicCamera(-window.innerHeight / 2, window.innerHeight / 2, window.innerHeight / 2, -window.innerHeight/2, 1.0, -1.0);
    //Koordinatensystem hinzufügen
    axis = new THREE.AxisHelper(window.innerHeight/2);
    scene.add(axis);
    //Punkte einlesen
    var input = prompt("Eingabe x1, y1, x2, y2:", " ");
    var partsOfStr = input.split(',');
    p1 = {
        x: 0,
        y: 0
    };
    p1.x = parseInt(partsOfStr[0]);
    p1.y = parseInt(partsOfStr[1]);
    p2 = {
        x: 0,
        y: 0
    };
    p2.x = parseInt(partsOfStr[2]);
    p2.y = parseInt(partsOfStr[3]);
    pointGeometry = new THREE.Geometry();
    var p = new THREE.Vector3();
    p.x = p1.x;
    p.y = p1.y;
    p.z = 0;
    pointGeometry.vertices.push(p);
    var p = new THREE.Vector3();
    p.x = p2.x;
    p.y = p2.y;
    p.z = 0;
    pointGeometry.vertices.push(p);
    line(p1, p2);
    var material = new THREE.PointsMaterial({ color: 0xFFFFFF });
    var pointarray = new THREE.Points( pointGeometry, material);
    scene.add(pointarray);
    //Renderer erzeugen
    renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
    renderer.setSize(window.innerHeight, window.innerHeight);
    renderer.setClearColor("rgb(0, 0, 0)", 1); //Hintergrundfarbe
    renderer.render(scene, camera);
    renderer.render(scene, camera);
}


var canvas;


// Ausfuehren der WebGL-Anwendung, wird durch den onLoad-Event von der Webseite aufgerufen 
function runWebGLApp() {
    canvas = document.getElementById("canvas-element-id");
    definitionScene(); 
}


</script>
</head>


<body onLoad='runWebGLApp()'>
    <canvas id="canvas-element-id" width="300" height="300"></canvas>
</body>
</html>
